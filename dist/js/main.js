var myModule=function(){var e=function(){n()},t=function(e){return e.replace(/\\/g,"/").replace(/.*\//,"")},n=function(){$("#add-new-item").on("click",i),$(".form-add-project").on("submit",a),$("#fileupload").on("change",o),$(".b-close").on("click",r)},r=function(e){var e=$(this);e.find(".input, .textarea").trigger("hideTooltip"),e.find(".has-error").removeClass("has-error"),e.find(".error-mes, success-mes").text("").hide()},o=function(){var e=$(this),n=t(e.val());$("#filename").val(n).trigger("hideTooltip").removeClass("has-error")},i=function(e){console.log("Вызов модального окна"),e.preventDefault();var t=$("#new-project-popup");form=t.find("form"),t.bPopup({speed:650,transition:"slideDown",onClose:function(){form.find(".server-mes").text("").hide(),form.trigger("reset")}})},a=function(e){console.log("Добавление проекта"),e.preventDefault();var t=$(this),n="add-project.php",r=s(t,n);r&&r.done(function(e){var n=t.find(".success-mes"),r=t.find(".error-mes");"OK"===e.mes?(erreoBox.hide(),n.text(e.text).show()):(n.hide(),r.text(e.text).show())})},s=function(e,t){if(!validation.validateForm(e))return!1;data=e.serialize();var n=$.ajax({url:t,type:"POST",dataType:"json",data:data}).fail(function(t){console.log("проблемы в php"),e.find(".error-mes").text("На сервере произошла ошибка").show()}).done(function(t){console.log("done"),e.find(".success-mes").text("Проект успешно добавлен").show()});return n};return{init:e}}();myModule.init(),$(document).ready(function(e){var t=e("#fileupload");t.on("change",function(){var n=t.val(),r=e(".input-add-picc");n=n.replace(/c:\\fakepath\\/gim,""),r.val(n)})});var validation=function(){var e=function(){t()},t=function(e,t){$("form").on("keydown",".has-error",n),$("form").on("reset",r)},n=function(){$(this).removeClass("has-error")},r=function(e){var e=$(this);e.find(".input, .textarea").trigger("hideTooltip"),e.find(".has-error").removeClass("has-error"),e.find(".error-mes, success-mes").text("").hide()},o=function(e,t){t="right"===t?{my:"left center",at:"right center"}:{my:"right center",at:"left center",adjust:{method:"shift none"}},e.qtip({content:{text:function(){return $(this).attr("qtip-content")}},show:{event:"show"},hide:{event:"keydown hideTooltip reset"},position:t,style:{classes:"qtip-mystyle qtip-rounded",tip:{height:10,width:16}}}).trigger("show")},i=function(e){var t=e.find("input, textarea").not('input[type="file"], input[type="hidden"]'),n=!0;return $.each(t,function(e,t){var r=$(t),t=r.val(),i=r.attr("qtip-position");0===t.length&&(r.addClass("has-error"),o(r,i),n=!1)}),n};return{init:e,validateForm:i}}();validation.init();